@model List<PruebaCrudMVC.Models.TableViewModels.CancionesTableViewModel>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutLogin.cshtml";
}

<h2>Favoritos</h2>
@*<div class="row">
        <div class="col-md-12">
            <input type="button" class="btn btn-primary" onclick="document.location.href='@Url.Content("~/Clientes/Add")'" value="Nuevo" />
        </div>
    </div>*@
<br>
<br>
<input type="text" id="buscar" placeholder="Buscar por canción o artista..." />
<br>
<br>
<div class="row">
    <div class="col-md-12">
        <table id="tablaCanciones" class="table-bordered">
            <thead>
                <tr>
                    <th class="col-md-4">Cancion</th>
                    <th class="col-md-4">Artista</th>
                    <th class="col-md-4">Genero</th>
                    <th class="col-md-4"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var elemento in Model)
                {
                    <tr>
                        <td style="display:none;">
                            <input type="hidden" class="id" value="@elemento.ID" />
                        </td>
                        <td>@elemento.Nombre</td>
                        <td>@elemento.Artista</td>
                        <td>@elemento.Genero</td>
                        <td>
                            <input onclick="jsDelete(@elemento.ID);" type="button" value="Favorito" class="btn btn-primary" />
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

    <script>
        function jsDelete(id)
        {
                url = "@Url.Content("~/Users/NoFavorito")" + "/"+ id;

                $.post(url, function (data)
                {
                    if (data == "1")
                    {
                        document.location.href = "@Url.Content("~/Users/")"
                    } else {
                        alert("Ocurrio un error")
                            }
                })
        }
    </script>

@section scripts{

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#buscar").on("keyup", function () {
                var texto = $(this).val();
                if (texto === "") {
                    location.reload(); // recarga para volver a ver el Razor
                    return;
                }
            $.ajax({
                url: '@Url.Action("BuscarFav", "Users")',
                data: { termino: texto },
                type: "GET",
                success: function (data) {
                    // Obtener el <tbody> de la tabla
                    console.log(data);
                var tbody = $("#tablaCanciones tbody");

                // 2️⃣ Limpiar el contenido anterior (incluyendo lo generado por Razor)
                tbody.empty();

                // 3️⃣ Si hay resultados, agregarlos
                if (data.length > 0) {
                    $.each(data, function (i, cancion) {
                        var fila = "<tr>" +
                            "<td>" + cancion.Nombre_Cancion + "</td>" +
                            "<td>" + cancion.Artista + "</td>" +
                            "<td>" + cancion.Genero + "</td>" +
                            "<td><input onclick='jsDelete(" + cancion.ID + ")' type='button' value='Favorito' class='btn btn-primary' /></td>" +
                            "</tr>";
                        tbody.append(fila);
                    });
                } else {
                    // 4️⃣ Si no hay resultados, mostrar mensaje
                    tbody.append("<tr><td colspan='4'>No se encontraron resultados</td></tr>");
                }
            },
            error: function () {
                alert("Ocurrió un error al buscar canciones.");
            }
            });
        });
    });
    </script>
}
